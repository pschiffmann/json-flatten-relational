var M=Object.defineProperty,C=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var g=(t,e,o)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,S=(t,e)=>{for(var o in e||(e={}))D.call(e,o)&&g(t,o,e[o]);if(v)for(var o of v(e))A.call(e,o)&&g(t,o,e[o]);return t},_=(t,e)=>C(t,U(e));import{j as N,R as j,r as f,X as h,a as I}from"./vendor.6d3c68ff.js";const J=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}};J();function P(t,e){switch(e.type){case"literal":return t===e.key;case"index":return typeof t=="number";case"regexp":return new RegExp(e.pattern,e.flags).test(t.toString())}}function V(t,e){const o=new Map,l=new Map;for(const r of e){let n=o.get(r.tableName);n||o.set(r.tableName,n={header:new Set,rows:[]});for(const i of r.path.map(u=>u.captureName).filter(u=>u!==void 0))n.header.add(i);for(const i of Object.keys(r.columns))n.header.add(i);const s=_(S({},r),{writeRow(i){n.rows.push(i)}});l.set(s,new Map)}return k(t,0,l),o}function k(t,e,o){if(typeof t!="object"||t===null)return;const l=Array.isArray(t)?t.entries():Object.entries(t);for(const[r,n]of l){const s=new Map;for(let[i,u]of o){const d=i.path[e];!P(r,d)||(d.captureName&&(u=new Map(u),u.set(d.captureName,r)),e===i.path.length-1?X(n,i,u):s.set(i,u))}s.size!==0&&k(n,e+1,s)}}function X(t,e,o){const l={};for(const[r,n]of o)l[r]=n;for(const[r,{path:n}]of Object.entries(e.columns)){const s=O(t,n);switch(typeof s){case"boolean":case"number":case"string":l[r]=s;break;case"object":l[r]=JSON.stringify(s);break}}e.writeRow(l)}function O(t,e){if(typeof t!="object"||t===null)return;const[o,...l]=e;if(typeof o=="number"===Array.isArray(t))return l.length?O(t[o],l):t[o]}const c=N.exports.jsx,m=N.exports.jsxs,$=j.memo(({name:t,data:e})=>{const[o,l]=f.exports.useState(!1),r=f.exports.useCallback(s=>{l(s.currentTarget.open)},[]),n=[...e.header];return m("details",{className:"table-preview",open:o,onToggle:r,children:[c("summary",{className:"table-preview__name",children:t}),o&&c("div",{className:"table-preview__container",children:m("table",{className:"table-preview__table",children:[c("thead",{children:c("tr",{children:n.map(s=>c("th",{className:"table-preview__header",children:s},s))})}),c("tbody",{children:e.rows.map((s,i)=>c("tr",{className:"table-preview__row",children:n.map(u=>{const d=s[u];return c("td",{className:"table-preview__cell table-preview__cell--"+typeof d,children:d},u)})},i))})]})})]})}),q=()=>{const[t,e]=f.exports.useState(""),[o,l]=f.exports.useState(""),[r,n]=f.exports.useState();f.exports.useEffect(()=>{fetch("sample-data.json").then(a=>a.text()).then(a=>e(p=>p!==""?p:a)),fetch("sample-schema.json").then(a=>a.text()).then(a=>l(p=>p!==""?p:a))},[]);const[s,i]=f.exports.useState();f.exports.useEffect(()=>{if(!!s)return()=>{URL.revokeObjectURL(s)}},[s]);const u=f.exports.useCallback(a=>{e(a.currentTarget.value),n(void 0),i(void 0)},[]),d=f.exports.useCallback(a=>{l(a.currentTarget.value),n(void 0),i(void 0)},[]);function R(){try{const a=z(t),p=B(o);n(V(a,p.resolvers))}catch(a){throw alert(`${a}`),a}}function E(){const a=h.utils.book_new();for(const[T,w]of r){const b=[...w.header],L=h.utils.aoa_to_sheet([b,...w.rows.map(y=>b.map(x=>y[x]!==null?y[x]:"null"))]);h.utils.book_append_sheet(a,L,T)}const p=h.write(a,{type:"array",bookType:"xlsx"});i(URL.createObjectURL(new Blob([p],{type:"application/octet-stream"})))}return m("div",{className:"app",children:[c("h1",{children:"json-flatten-relational"}),c("a",{className:"app__link",href:"https://github.com/pschiffmann/json-flatten-relational#readme",target:"_blank",children:"Docs"}),c("h2",{children:"JSON source"}),c("textarea",{className:"app__textarea",value:t,onChange:u}),c("h2",{children:"Schema"}),c("textarea",{className:"app__textarea",value:o,onChange:d}),c("h2",{children:"Result"}),!r&&c("button",{onClick:R,children:"Run"}),r&&[...r].map(([a,p])=>c($,{name:a,data:p},a)),r&&(s?c("a",{href:s,download:"untitled.xlsx",children:"Download as .xlsx"}):c("button",{onClick:E,children:"Export as .xslx"}))]})};function z(t){try{return JSON.parse(t)}catch(e){throw e instanceof SyntaxError?new Error(`Invalid JSON source syntax:
${e}`):e}}function B(t){let e;try{e=JSON.parse(t)}catch(o){throw o instanceof SyntaxError?new Error(`Invalid schema syntax:
${o}`):o}if(e.version!=="1")throw new Error("Unsupported schema version.");if(typeof e.resolvers!="object")throw new Error("Schema has no table resolvers.");return e}I.render(c(j.StrictMode,{children:c(q,{})}),document.querySelector("#root"));

var M=Object.defineProperty,C=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var _=(t,e,n)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,S=(t,e)=>{for(var n in e||(e={}))D.call(e,n)&&_(t,n,e[n]);if(v)for(var n of v(e))A.call(e,n)&&_(t,n,e[n]);return t},g=(t,e)=>C(t,U(e));import{j as N,R as k,r as h,X as d,a as I}from"./vendor.6d3c68ff.js";const J=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};J();function P(t,e){switch(e.type){case"literal":return t===e.key;case"index":return typeof t=="number";case"pattern":return new RegExp(e.pattern,e.flags).test(t.toString())}}function V(t,e){const n={},l=new Map;for(const[r,o]of Object.entries(e)){n[r]={header:new Set([...o.path.map(i=>i.captureName).filter(i=>i!==void 0),...Object.keys(o.columns)]),rows:[]};const s=g(S({},o),{writeRow(i){n[r].rows.push(i)}});l.set(s,new Map)}return j(t,0,l),n}function j(t,e,n){if(typeof t!="object"||t===null)return;const l=Array.isArray(t)?t.entries():Object.entries(t);for(const[r,o]of l){const s=new Map;for(let[i,p]of n){const f=i.path[e];!P(r,f)||(f.captureName&&(p=new Map(p),p.set(f.captureName,r)),e===i.path.length-1?X(o,i,p):s.set(i,p))}s.size!==0&&j(o,e+1,s)}}function X(t,e,n){const l={};for(const[r,o]of n)l[r]=o;for(const[r,{path:o}]of Object.entries(e.columns)){const s=O(t,o);switch(typeof s){case"boolean":case"number":case"string":l[r]=s;break;case"object":l[r]=JSON.stringify(s);break}}e.writeRow(l)}function O(t,e){if(typeof t!="object"||t===null)return;const[n,...l]=e;if(typeof n=="number"===Array.isArray(t))return l.length?O(t[n],l):t[n]}const c=N.exports.jsx,m=N.exports.jsxs,$=k.memo(({name:t,data:e})=>{const[n,l]=h.exports.useState(!1),r=h.exports.useCallback(s=>{l(s.currentTarget.open)},[]),o=[...e.header];return m("details",{className:"table-preview",open:n,onToggle:r,children:[c("summary",{className:"table-preview__name",children:t}),n&&c("div",{className:"table-preview__container",children:m("table",{className:"table-preview__table",children:[c("thead",{children:c("tr",{children:o.map(s=>c("th",{className:"table-preview__header",children:s},s))})}),c("tbody",{children:e.rows.map((s,i)=>c("tr",{className:"table-preview__row",children:o.map(p=>{const f=s[p];return c("td",{className:"table-preview__cell table-preview__cell--"+typeof f,children:f},p)})},i))})]})})]})}),q=()=>{const[t,e]=h.exports.useState(""),[n,l]=h.exports.useState(""),[r,o]=h.exports.useState();h.exports.useEffect(()=>{fetch("sample-data.json").then(a=>a.text()).then(a=>e(u=>u!==""?u:a)),fetch("sample-schema.json").then(a=>a.text()).then(a=>l(u=>u!==""?u:a))},[]);const[s,i]=h.exports.useState();h.exports.useEffect(()=>{if(!!s)return()=>{URL.revokeObjectURL(s)}},[s]);const p=h.exports.useCallback(a=>{e(a.currentTarget.value),o(void 0),i(void 0)},[]),f=h.exports.useCallback(a=>{l(a.currentTarget.value),o(void 0),i(void 0)},[]);function R(){try{const a=z(t),u=B(n);o(V(a,u.tables))}catch(a){throw alert(`${a}`),a}}function E(){const a=d.utils.book_new();for(const[T,b]of Object.entries(r)){const w=[...b.header],L=d.utils.aoa_to_sheet([w,...b.rows.map(y=>w.map(x=>y[x]!==null?y[x]:"null"))]);d.utils.book_append_sheet(a,L,T)}const u=d.write(a,{type:"array",bookType:"xlsx"});i(URL.createObjectURL(new Blob([u],{type:"application/octet-stream"})))}return m("div",{className:"app",children:[c("h1",{children:"json-flatten-relational"}),m("div",{className:"app__links",children:[c("a",{className:"app__link",href:"#",target:"_blank",children:"Docs"}),c("a",{className:"app__link",href:"#",target:"_blank",children:"GitHub"})]}),c("h2",{children:"JSON source"}),c("textarea",{className:"app__textarea",value:t,onChange:p}),c("h2",{children:"Schema"}),c("textarea",{className:"app__textarea",value:n,onChange:f}),c("h2",{children:"Result"}),!r&&c("button",{onClick:R,children:"Run"}),r&&Object.entries(r).map(([a,u])=>c($,{name:a,data:u},a)),r&&(s?c("a",{href:s,download:"untitled.xlsx",children:"Download as .xlsx"}):c("button",{onClick:E,children:"Export as .xslx"}))]})};function z(t){try{return JSON.parse(t)}catch(e){throw e instanceof SyntaxError?new Error(`Invalid JSON source syntax:
${e}`):e}}function B(t){let e;try{e=JSON.parse(t)}catch(n){throw n instanceof SyntaxError?new Error(`Invalid schema syntax:
${n}`):n}if(e.version!=="1")throw new Error("Unsupported schema version.");if(typeof e.tables!="object")throw new Error("Schema has no tables.");return e}I.render(c(k.StrictMode,{children:c(q,{})}),document.querySelector("#root"));
